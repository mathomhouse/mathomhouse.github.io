<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Perk Tree</title>
<link rel="stylesheet" href="/styles/index.css" />
<style>
  body {
    background:#0a0f1c;
    color:#fff;
    margin:0;
    font-family:sans-serif;
  }

  .tree-wrapper{
    width:100%;
    height:100vh;
    overflow-y:auto;
    position:relative;
    padding-inline:12px;
    box-sizing:border-box;
  }

  #tree-lines{
    position:absolute;
    top:0;
    left:0;
    width:100%;
    height:100%;
    pointer-events:none;
  }

  .tree-grid{
    position:relative;
    display:grid;
    grid-template-columns:repeat(5,140px);
    grid-auto-rows:160px;
    justify-content:center;
    padding-top:56px;
    padding-bottom:220px;
    gap:8px 0;
  }

  .talent-node{
  width:140px;
  margin:auto;
  cursor:pointer;
  display:flex;
  flex-direction:column;
  align-items:center;
  text-align:center;
  padding:6px 0;
  touch-action:manipulation;
  box-sizing:border-box;
}

/* NEW: normalize label height so hexes stay aligned in the row */
.talent-node-label{
  margin-bottom:8px;
  font-size:15px;
  font-weight:600;
  color:#e5e7eb;
  text-shadow:0 0 4px #000;
  max-width:130px;

  min-height: 36px;              /* enough for up to two lines */
  display:flex;
  align-items:flex-end;          /* bottom-align the text within the label box */
  justify-content:center;
  text-align:center;
}


  .talent-node-inner{
    width:112px;
    height:118px;
    clip-path:polygon(25% 0%,75% 0%,100% 50%,75% 100%,25% 100%,0% 50%);
    background:radial-gradient(circle at 30% 0%, #3349a5 0, #111827 55%, #020617 100%);
    border:2px solid rgba(129, 140, 248, 0.75);
    box-shadow:
      0 0 12px rgba(37, 99, 235, 0.35),
      0 0 0 1px rgba(15, 23, 42, 0.9);
    display:flex;
    flex-direction:column;
    justify-content:center; /* center vertically */
    align-items:center;
    padding-bottom:0;       /* remove bottom bias */
    position:relative;
    overflow:hidden;
    transition:
      transform 150ms ease-out,
      box-shadow 150ms ease-out,
      border-color 150ms ease-out,
      background 150ms ease-out;
  }

  .talent-node-inner::before{
    content:"";
    position:absolute;
    inset:10%;
    border-radius:999px;
    background:radial-gradient(circle at 50% 0%, rgba(96,165,250,0.45), transparent 55%);
    opacity:0.85;
    mix-blend-mode:screen;
    pointer-events:none;
  }

  @media (hover:hover){
    .talent-node:hover .talent-node-inner{
      transform:translateY(-3px) scale(1.03);
      box-shadow:
        0 0 18px rgba(59,130,246,0.6),
        0 0 0 1px rgba(148,163,184,0.9);
      border-color:rgba(191, 219, 254, 0.95);
      background:radial-gradient(circle at 30% 0%, #4f46e5 0, #0f172a 55%, #020617 100%);
    }
  }

  .talent-level-text{
    font-size:13px;
    font-weight:700;
    letter-spacing:0.02em;
    text-transform:uppercase;
    color:#e5e7eb;
    text-shadow:0 0 4px #000;
  }

  .talent-stat-text{
    margin-top:6px;
    font-size:12px;
    line-height:1.35;
    color:#cbd5f5;
    padding:0 10px;
  }

  /* Detail panel (desktop default) */
  .node-details{
    position:fixed;
    right:20px;
    bottom:20px;
    max-width:340px;
    background:rgba(15,23,42,0.95);
    border:1px solid rgba(148,163,184,0.65);
    border-radius:14px;
    padding:14px 16px 16px;
    box-shadow:0 18px 40px rgba(0,0,0,0.65);
    font-size:14px;
    z-index:50;
    box-sizing:border-box;
  }

  .hidden{
    display:none;
  }

  .node-details-close{
    position:absolute;
    top:6px;
    right:8px;
    border:none;
    background:transparent;
    color:#9ca3af;
    font-size:18px;
    cursor:pointer;
    padding:4px;
    line-height:1;
  }

  .node-details-close:hover{
    color:#e5e7eb;
  }

  .node-details h2{
    margin:0 32px 6px 0;
    font-size:15px;
    font-weight:700;
    color:#e5e7eb;
  }

  .node-detail-line{
    margin:3px 0;
    line-height:1.35;
  }

  .node-detail-label{
    display:inline-block;
    font-size:11px;
    text-transform:uppercase;
    letter-spacing:0.08em;
    color:#9ca3af;
    margin-bottom:1px;
  }

  .node-detail-value{
    display:block;
    color:#e5e7eb;
  }

  /* Mobile / small screens */
  @media (max-width: 768px){
    .tree-wrapper{
      padding-inline:6px;
    }

    .tree-grid{
      grid-template-columns:repeat(3, minmax(100px, 1fr));
      grid-auto-rows:140px;
      padding-top:32px;
      padding-bottom:180px;
    }

    .talent-node{
      width:100%;
      padding:4px 0;
    }

    .talent-node-label{
    font-size:14px;
    max-width:120px;
    min-height: 34px;
    }

    .talent-node-inner{
      width:100px;
      height:104px;
    }

    .node-details{
      left:12px;
      right:12px;
      bottom:12px;
      max-width:none;
      border-radius:18px 18px 16px 16px;
      padding:16px 18px 18px;
    }

    .node-details h2{
      font-size:16px;
      margin-right:36px;
    }

    .node-detail-line{
      font-size:13px;
    }

    .node-details-close{
      font-size:20px;
      padding:6px;
      top:8px;
      right:10px;
    }
  }
  @media (prefers-color-scheme: light) {
  .talent-node-label {
    color:#111827;  /* dark slate for light mode */
    text-shadow:none;
  }
}
body.light-mode .talent-node-label,
[data-theme="light"] .talent-node-label {
  color:#111827;
  text-shadow:none;
}
/* Force perk name text to be dark in light theme */
html[data-theme="light"] .talent-node-label,
body[data-theme="light"] .talent-node-label,
html.light-mode .talent-node-label,
body.light-mode .talent-node-label {
  color: #111827 !important;
  text-shadow: none !important;
}

/* If you *also* want it to react to OS light mode: */
@media (prefers-color-scheme: light) {
  .talent-node-label {
    color: #111827 !important;
    text-shadow: none !important;
  }
}

</style>
<script src="/header.js" defer></script>
</head>
<body>
  <header id="header-placeholder"></header>

  <div class="tree-wrapper">
    <svg id="tree-lines"></svg>
    <div id="tree" class="tree-grid"></div>
  </div>

  <div id="node-details" class="node-details hidden">
    <button class="node-details-close">Ã—</button>
    <h2 id="detail-name"></h2>

    <p class="node-detail-line">
      <span class="node-detail-label">Stat</span>
      <span id="detail-stat" class="node-detail-value"></span>
    </p>

    <p class="node-detail-line">
      <span class="node-detail-label">Tiers</span>
      <span id="detail-tiers" class="node-detail-value"></span>
    </p>

    <p class="node-detail-line">
      <span class="node-detail-label">Cost</span>
      <span id="detail-cost" class="node-detail-value"></span>
    </p>

    <p class="node-detail-line">
      <span class="node-detail-label">Requirements</span>
      <span id="detail-prereq" class="node-detail-value"></span>
    </p>
  </div>

  <script>
  const talentTree = {
    pointsAvailable: 500,
    nodes: [
      {
        id: "full_rest",
        perkName: "Full Rest",
        stat: "All Units HP +2%",
        maxLevel: 5,
        costPerLevel: [6, 6, 6, 6, 6],
        row: 1,
        col: 3,
        prereq: null
      },
      {
        id: "army_atk",
        perkName: "Army Readiness",
        stat: "Army Attack +2%",
        maxLevel: 5,
        costPerLevel: [6, 6, 6, 6, 6],
        row: 2,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["full_rest"],
          minCompleted: 1
        }
      },
      {
        id: "navy_atk",
        perkName: "Naval Readiness",
        stat: "Navy Attack +2%",
        maxLevel: 5,
        costPerLevel: [6, 6, 6, 6, 6],
        row: 2,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["full_rest"],
          minCompleted: 1
        }
      },
      {
        id: "air_atk",
        perkName: "Air Force Readiness",
        stat: "Air Force Attack +2%",
        maxLevel: 5,
        costPerLevel: [6, 6, 6, 6, 6],
        row: 2,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["full_rest"],
          minCompleted: 1
        }
      },
      {
        id: "coordinated_defense",
        perkName: "Coordinated Defense",
        stat: "All Units DEF +2%",
        maxLevel: 5,
        costPerLevel: [6, 6, 6, 6, 6],
        row: 3,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["army_atk", "navy_atk", "air_atk"],
          minCompleted: 3
        }
      },
      {
        id: "shark_scorpion_tier_plus1",
        perkName: "Evolved Shark/Scorpion",
        stat: "Shark/Scorpion Tier +1",
        maxLevel: 1,
        costPerLevel: [30],
        row: 4,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["coordinated_defense"],
          minCompleted: 1
        }
      },
      {
        id: "unified_assault",
        perkName: "Unified Assault",
        stat: "All Units Attack +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 4,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["coordinated_defense"],
          minCompleted: 1
        }
      },
      {
        id: "rapid_logistics",
        perkName: "Rapid Logistics",
        stat: "All Units HP +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 4,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["coordinated_defense"],
          minCompleted: 1
        }
      },
      {
        id: "ammo_amplifier",
        perkName: "Ammo Amplifier",
        stat: "All Units Attack +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 5,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["unified_assault", "rapid_logistics"],
          minCompleted: 2
        }
      },
      {
        id: "controlled_progression",
        perkName: "Controlled Progression",
        stat: "DEF increase when attacking buildings +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 6,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["ammo_amplifier"],
          minCompleted: 1
        }
      },
      {
        id: "dauntless_stand",
        perkName: "Dauntless Stand",
        stat: "DEF increase when defending buildings +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 6,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["ammo_amplifier"],
          minCompleted: 1
        }
      },
      {
        id: "incremental_resupply",
        perkName: "Incremental Resupply",
        stat: "All Units HP +2%",
        maxLevel: 5,
        costPerLevel: [7, 7, 7, 7, 7],
        row: 7,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["controlled_progression", "dauntless_stand"],
          minCompleted: 2
        }
      },
      {
        id: "shark_scorpion_specialization_plus1",
        perkName: "Shark Impact/Scorpion Sting",
        stat: "Shark/Scorpion Specialization +1",
        maxLevel: 1,
        costPerLevel: [35],
        row: 8,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["incremental_resupply"],
          minCompleted: 1
        }
      },
      {
        id: "caliber_enhancement",
        perkName: "Caliber Enhancement",
        stat: "DMG Decrease +1%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 8,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["incremental_resupply"],
          minCompleted: 1
        }
      },
      {
        id: "heavy_armor_layer",
        perkName: "Heavy Armor Layer",
        stat: "DMG Decrease +1%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 8,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["incremental_resupply"],
          minCompleted: 1
        }
      },
      {
        id: "all-out_focus",
        perkName: "All-Out Focus",
        stat: "All Units Attack +2%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 9,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["caliber_enhancement", "heavy_armor_layer"],
          minCompleted: 2
        }
      },
      {
        id: "sky_predator",
        perkName: "Sky Predator",
        stat: "Army - Air DMG Bonus +3%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 10,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["all-out_focus"],
          minCompleted: 1
        }
      },
      {
        id: "oceanic_predator",
        perkName: "Oceanic Predator",
        stat: "Air Force - Navy DMG Bonus +3%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 10,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["all-out_focus"],
          minCompleted: 1
        }
      },
      {
        id: "ground_predator",
        perkName: "Ground Predator",
        stat: "Navy - Army DMG Bonus +3%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 10,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["all-out_focus"],
          minCompleted: 1
        }
      },
      {
        id: "full_supply",
        perkName: "Full Supply",
        stat: "All Units HP +2%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 11,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["sky_predator","oceanic_predator","ground_predator"],
          minCompleted: 3
        }
      },
      {
        id: "shadow_of_the_shark",
        perkName: "Shadow of the Shark",
        stat: "Shark queue +1",
        maxLevel: 1,
        costPerLevel: [40],
        row: 12,
        col: 3,
        prereq: {
          type: "all",
          nodes: ["full_supply"],
          minCompleted: 1
        }
      },
      {
        id: "aim_calibration",
        perkName: "Aim Calibration",
        stat: "Damage Increase +4%",
        maxLevel: 5,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 12,
        col: 2,
        prereq: {
          type: "all",
          nodes: ["full_supply"],
          minCompleted: 1
        }
      },
      {
        id: "light_armor_layer",
        perkName: "Light Armor Layer",
        stat: "Damage Decrease +4%",
        maxLevel: 1,
        costPerLevel: [17, 17, 17, 17, 17],
        row: 12,
        col: 4,
        prereq: {
          type: "all",
          nodes: ["full_supply"],
          minCompleted: 1
        }
      }
    ]
  };

  function renderTree(){
    const grid = document.getElementById("tree");
    grid.innerHTML = "";
    talentTree.nodes.forEach(node => {
      const el = document.createElement("div");
      el.className = "talent-node";
      el.dataset.id = node.id;
      el.style.gridRow = node.row;
      el.style.gridColumn = node.col;
      const tierLabel = node.maxLevel === 1 ? "1 tier" : node.maxLevel + " tiers";
      el.innerHTML = `
        <div class="talent-node-label">${node.perkName}</div>
        <div class="talent-node-inner">
          <div class="talent-level-text">${tierLabel}</div>
          <div class="talent-stat-text">${node.stat}</div>
        </div>
      `;
      grid.appendChild(el);
    });
  }

  function resizeSVG(){
    const grid = document.getElementById("tree");
    const svg = document.getElementById("tree-lines");
    if (!grid || !svg) return;
    svg.style.height = grid.scrollHeight + "px";
  }

  function drawLines(){
    resizeSVG();
    const svg = document.getElementById("tree-lines");
    svg.innerHTML = "";
    const svgRect = svg.getBoundingClientRect();
    talentTree.nodes.forEach(node => {
      if (!node.prereq || !node.prereq.nodes) return;
      const child = document.querySelector(`[data-id="${node.id}"]`);
      if (!child) return;
      const c = child.getBoundingClientRect();
      const x2 = c.left + c.width/2 - svgRect.left;
      const y2 = c.top + c.height/2 - svgRect.top;
      node.prereq.nodes.forEach(pid => {
        const parent = document.querySelector(`[data-id="${pid}"]`);
        if (!parent) return;
        const p = parent.getBoundingClientRect();
        const x1 = p.left + p.width/2 - svgRect.left;
        const y1 = p.top + p.height/2 - svgRect.top;
        const line = document.createElementNS("http://www.w3.org/2000/svg","line");
        line.setAttribute("x1", x1);
        line.setAttribute("y1", y1);
        line.setAttribute("x2", x2);
        line.setAttribute("y2", y2);
        line.setAttribute("stroke", "#3ea0ff");
        line.setAttribute("stroke-width", "4");
        line.setAttribute("stroke-linecap", "round");
        svg.appendChild(line);
      });
    });
  }

  function showDetails(node){
    const panel = document.getElementById("node-details");
    document.getElementById("detail-name").textContent = node.perkName;
    document.getElementById("detail-stat").textContent = node.stat;
    document.getElementById("detail-tiers").textContent =
      node.maxLevel === 1 ? "1 tier" : `${node.maxLevel} tiers`;
    const total = node.costPerLevel.reduce((a,b)=>a+b,0);
    document.getElementById("detail-cost").textContent =
      `Per tier: ${node.costPerLevel.join(", ")} (Total ${total})`;
    let prereq = "Starting node (no prerequisites)";
    if (node.prereq){
      const names = node.prereq.nodes.map(id => {
        const n = talentTree.nodes.find(x => x.id === id);
        return n ? n.perkName : id;
      }).join(", ");
      if (node.prereq.type === "any" && node.prereq.minCompleted < node.prereq.nodes.length){
        prereq = `Requires at least ${node.prereq.minCompleted} of: ${names}`;
      } else {
        prereq = `Requires all of: ${names}`;
      }
    }
    document.getElementById("detail-prereq").textContent = prereq;
    panel.classList.remove("hidden");
  }

  document.addEventListener("click", e => {
    if (e.target.closest(".node-details-close")){
      document.getElementById("node-details").classList.add("hidden");
      return;
    }
    const nodeEl = e.target.closest(".talent-node");
    if (!nodeEl) return;
    const node = talentTree.nodes.find(n => n.id === nodeEl.dataset.id);
    showDetails(node);
    // redraw lines after potential layout changes (esp. on mobile)
    setTimeout(drawLines, 0);
  });

  window.addEventListener("resize", () => {
    drawLines();
  });

  window.addEventListener("load", () => {
    renderTree();
    // Let layout settle before drawing lines so positions are correct
    setTimeout(drawLines, 50);
  });
  </script>
</body>
</html>
