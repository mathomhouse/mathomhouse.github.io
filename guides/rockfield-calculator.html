<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rockfield Open-Hit Calculator (Simple)</title>
  <link rel="stylesheet" href="/styles/index.css"/>
  <script src="/header.js" defer></script>
  <style>
    .wrap{max-width:880px;margin:0 auto;padding:1rem;}
    .card{border:1px solid rgba(0,0,0,.12);border-radius:12px;padding:1rem;box-shadow:0 4px 10px rgba(0,0,0,.05);}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.9rem;}
    label{font-weight:600;display:block;margin-bottom:.35rem;}
    input,select{width:100%;padding:.55rem .6rem;border:1px solid rgba(0,0,0,.2);border-radius:8px;}
    .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin-top:.8rem;}
    .btn{padding:.6rem .9rem;border-radius:10px;border:1px solid rgba(0,0,0,.2);background:#fff;cursor:pointer;}
    .btn.primary{background:#111;color:#fff;}
    .muted{color:#555;font-size:.92rem;}
    .result{margin-top:1rem;padding:.9rem;border-radius:10px;background:rgba(0,0,0,.03);}
    .result h3{margin:.1rem 0 .45rem}
    .small{font-size:.9rem}
    code.kbd{background:rgba(0,0,0,.06);padding:.1rem .4rem;border-radius:.35rem}
  </style>
</head>
<body>
<header id="header-placeholder"></header>
<div class="wrap">
  <h1>Rockfield Calculator </h1>
  <p>
    Input your march size and your opponents march size, your average unit level and the opponents average unit level, and the Exclusive Skill level for your Rockfield.
    True damage percentage will vary player to player depending on your "War" statistic. The default value will be set to 27% but you can input whatever your accounts percentage shows on Rockfield's Hero page.
  </p>

  <div class="card">
    <div class="grid">
      <div>
        <label for="basePct">Base True Damage %</label>
        <input id="basePct" type="number" min="1" max="100" step="0.1" value="27">
        <div class="small muted">Defaults to 27%. Change to what is shown on your Rockfield skill (not exclusive skill)</div>
      </div>
      <div>
        <label for="yourMarch">Your March Size</label>
        <input id="yourMarch" type="number" min="1" placeholder="Enter march size">
      </div>
      <div>
        <label for="enemyMarch">Enemy March Size</label>
        <input id="enemyMarch" type="number" min="1" placeholder="Enter march size">
      </div>
      <div>
        <label for="yourLvl">Your Average Unit Level</label>
        <select id="yourLvl">
          <option value="" disabled selected>Select option</option>
          <option>101</option>
          <option>102</option>
          <option value="103">103 / Vals</option>
        </select>
      </div>
      <div>
        <label for="enemyLvl">Enemy Average Unit Level</label>
        <select id="enemyLvl">
          <option value="" disabled selected>Select option</option>
          <option>101</option>
          <option>102</option>
          <option value="103">103 / Vals</option>
        </select>
      </div>
      <div>
        <label for="skillLvl">Rockfield Skill Level</label>
        <select id="skillLvl">
          <option value="" disabled selected>Select option</option>
          <option value="0">No ES (+0%)</option>
          <option value="1">ES 1 (+2%)</option>
          <option value="2">ES 2 (+4%)</option>
          <option value="3">ES 3 (+6%)</option>
          <option value="4">ES 4 (+8%)</option>
          <option value="5">ES 5 (+11%)</option>
          <option value="6">ES 6 (+18%)</option>
          <option value="7">ES 7 (+22%)</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="btn primary" id="calcBtn" type="button">Calculate</button>
      <button class="btn" id="resetBtn" type="button">Reset</button>
      <span class="muted small">Output is a single effective % of each enemy stack’s max HP.</span>
    </div>

    <div class="result" id="resultBox" hidden>
      <h3>Effective Damage</h3>
      <div id="resultText"></div>
    </div>
  </div>
</div>

<script>
function compute(){
  const basePctInput = Math.max(0.0001, parseFloat(document.getElementById('basePct').value || '27'));
  const base = basePctInput / 100.0;

  const yourMarch = Math.max(1, parseFloat(document.getElementById('yourMarch').value || '1'));
  const enemyMarch = Math.max(1, parseFloat(document.getElementById('enemyMarch').value || '1'));
  const yourLvl = parseInt(document.getElementById('yourLvl').value, 10);
  const enemyLvl = parseInt(document.getElementById('enemyLvl').value, 10);
  const skillLvl = parseInt(document.getElementById('skillLvl').value, 10);

  const skillBonus = 0.02 * skillLvl; // +2% per level
  const baseWithSkill = base * (1 + skillBonus); // multiplicative

  const levelDiff = Math.max(0, enemyLvl - yourLvl);
  const afterLevel = baseWithSkill * Math.pow(0.5, levelDiff);

  const sizeRatio = Math.min(1, yourMarch / enemyMarch); // reduce if smaller, no bonus if larger
  const finalPct = Math.max(0, Math.min(1, afterLevel * sizeRatio));

  const pctText = (finalPct * 100).toFixed(3) + '%';
  const breakdown = [
    `<div class="small">Base: ${(base*100).toFixed(3)}%</div>`,
    `<div class="small">After Skill (×${(1+skillBonus).toFixed(3)}): ${(baseWithSkill*100).toFixed(3)}%</div>`,
    `<div class="small">After Level (−${Math.max(0, enemyLvl-yourLvl)} level diff): ${(afterLevel*100).toFixed(3)}%</div>`,
    `<div class="small">After March (×${sizeRatio.toFixed(3)}): ${(finalPct*100).toFixed(3)}%</div>`
  ].join('');

  const text = document.getElementById('resultText');
  text.innerHTML = `<div><strong>${pctText}</strong> of each enemy stack's max HP</div><hr/>${breakdown}`;
  document.getElementById('resultBox').hidden = false;
}

document.getElementById('calcBtn').addEventListener('click', compute);
document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('basePct').value = 27;
  document.getElementById('yourMarch').value = 300;
  document.getElementById('enemyMarch').value = 400;
  document.getElementById('yourLvl').value = '102';
  document.getElementById('enemyLvl').value = '103';
  document.getElementById('skillLvl').value = '7';
  document.getElementById('resultBox').hidden = true;
});
</script>
</body>
</html>
