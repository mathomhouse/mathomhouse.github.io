<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Rockfield Open-Hit Calculator (Simple)</title>
  <link rel="stylesheet" href="/styles/index.css"/>
  <script src="/header.js" defer></script>
  <style>
    .wrap{max-width:880px;margin:0 auto;padding:1rem;}
    .card{border:1px solid rgba(0,0,0,.12);border-radius:12px;padding:1rem;box-shadow:0 4px 10px rgba(0,0,0,.05);}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:.9rem;}
    label{font-weight:600;display:block;margin-bottom:.35rem;}
    input,select{width:100%;padding:.55rem .6rem;border:1px solid rgba(0,0,0,.2);border-radius:8px;}
    .row{display:flex;gap:.6rem;align-items:center;flex-wrap:wrap;margin-top:.8rem;}
    .btn{padding:.6rem .9rem;border-radius:10px;border:1px solid rgba(0,0,0,.2);background:#fff;cursor:pointer;}
    .btn.primary{background:#111;color:#fff;}
    .muted{color:#555;font-size:.92rem;}
    .result{margin-top:1rem;padding:.9rem;border-radius:10px;background:rgba(0,0,0,.03);}
    .result h3{margin:.1rem 0 .45rem}
    .small{font-size:.9rem}
    code.kbd{background:rgba(0,0,0,.06);padding:.1rem .4rem;border-radius:.35rem}
  </style>
</head>
<body>
<header id="header-placeholder"></header>
<div class="wrap">
  <h1>Rockfield Open-Hit Calculator (Simple)</h1>
  <p class="muted">
    Uses multiplicative exclusive skill scaling, per your rule: if base were 30% and skill level is 3 (+6%), the new base is
    <em>30% × 1.06 = 31.8%</em>. Default base here is the Rockfield description value <strong>27%</strong>.
  </p>

  <div class="card">
    <div class="grid">
      <div>
        <label for="yourMarch">Your March Size</label>
        <input id="yourMarch" type="number" min="1" value="300">
      </div>
      <div>
        <label for="enemyMarch">Enemy March Size</label>
        <input id="enemyMarch" type="number" min="1" value="400">
      </div>
      <div>
        <label for="yourLvl">Your Average Unit Level</label>
        <select id="yourLvl">
          <option>101</option>
          <option selected>102</option>
          <option>103</option>
          <option>104</option>
        </select>
      </div>
      <div>
        <label for="enemyLvl">Enemy Average Unit Level</label>
        <select id="enemyLvl">
          <option>101</option>
          <option>102</option>
          <option selected>103</option>
          <option>104</option>
        </select>
      </div>
      <div>
        <label for="skillLvl">Rockfield Skill Level</label>
        <select id="skillLvl">
          <option value="0">0 (+0%)</option>
          <option value="1">1 (+2%)</option>
          <option value="2">2 (+4%)</option>
          <option value="3">3 (+6%)</option>
          <option value="4">4 (+8%)</option>
          <option value="5">5 (+10%)</option>
          <option value="6">6 (+12%)</option>
          <option value="7" selected>7 (+14%)</option>
        </select>
      </div>
    </div>

    <div class="row">
      <button class="btn primary" id="calcBtn" type="button">Calculate</button>
      <button class="btn" id="resetBtn" type="button">Reset</button>
      <span class="muted small">Formula shown below. No rounding options; output is a single %.</span>
    </div>

    <div class="result" id="resultBox" hidden>
      <h3>Effective Damage</h3>
      <div id="resultText"></div>
    </div>
  </div>

  <h2>Formula</h2>
  <p class="small">
    <code class="kbd">base = 0.27</code> (27%)<br/>
    <code class="kbd">skillBonus = 0.02 × skillLvl</code><br/>
    <code class="kbd">baseWithSkill = base × (1 + skillBonus)</code><br/>
    <code class="kbd">afterLevel = baseWithSkill × (0.5)^(max(0, enemyLvl - yourLvl))</code><br/>
    <code class="kbd">finalPct = afterLevel × min(1, yourMarch / enemyMarch)</code>
  </p>
</div>

<script>
function compute(){
  const yourMarch = Math.max(1, parseFloat(document.getElementById('yourMarch').value || '1'));
  const enemyMarch = Math.max(1, parseFloat(document.getElementById('enemyMarch').value || '1'));
  const yourLvl = parseInt(document.getElementById('yourLvl').value, 10);
  const enemyLvl = parseInt(document.getElementById('enemyLvl').value, 10);
  const skillLvl = parseInt(document.getElementById('skillLvl').value, 10);

  const base = 0.27; // 27%
  const skillBonus = 0.02 * skillLvl; // +2% per level
  const baseWithSkill = base * (1 + skillBonus); // multiplicative per your clarification

  const levelDiff = Math.max(0, enemyLvl - yourLvl);
  const afterLevel = baseWithSkill * Math.pow(0.5, levelDiff);

  const sizeRatio = Math.min(1, yourMarch / enemyMarch); // reduce if smaller, no bonus if larger
  const finalPct = Math.max(0, Math.min(1, afterLevel * sizeRatio));

  const pctText = (finalPct * 100).toFixed(3) + '%';
  const breakdown = [
    `<div class="small">Base: ${(base*100).toFixed(2)}%</div>`,
    `<div class="small">After Skill (×${(1+skillBonus).toFixed(3)}): ${(baseWithSkill*100).toFixed(3)}%</div>`,
    `<div class="small">After Level (−${Math.max(0, enemyLvl-yourLvl)} level diff): ${(afterLevel*100).toFixed(3)}%</div>`,
    `<div class="small">After March (×${sizeRatio.toFixed(3)}): ${(finalPct*100).toFixed(3)}%</div>`
  ].join('');

  const text = document.getElementById('resultText');
  text.innerHTML = `<div><strong>${pctText}</strong> of each enemy stack's max HP</div><hr/>${breakdown}`;
  document.getElementById('resultBox').hidden = false;
}

document.getElementById('calcBtn').addEventListener('click', compute);
document.getElementById('resetBtn').addEventListener('click', () => {
  document.getElementById('yourMarch').value = 300;
  document.getElementById('enemyMarch').value = 400;
  document.getElementById('yourLvl').value = '102';
  document.getElementById('enemyLvl').value = '103';
  document.getElementById('skillLvl').value = '7';
  document.getElementById('resultBox').hidden = true;
});
</script>
</body>
</html>
